<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="cropped_image.png" type="image/x-icon" />
    <title>Fixture</title>
    <link href="style.css" />
  </head>
  <body>
    <div id="navbar-placeholder"></div>
    <section class="section">
      <h1>Fixture & Result</h1>
      <h3 id="playoff">Playoffs</h3>
    </section>
    <div class="season-selector">
      <label class="season-select" for="season-dropdown">Select Season:</label>
      <select id="season-dropdown">
        <option value="season1">Season 1</option>
        <option value="season2">Season 2</option>
      </select>
    </div>

    <div class="fixtures" id="fixtures-container"></div>

    <!-- Modal for Team History -->
    <div class="modal-overlay" id="modal-overlay"></div>
    <div class="modal" id="team-history-modal">
      <h2 id="modal-title"></h2>
      <div id="modal-content"></div>
      <span class="close-modal" id="close-modal">Close</span>
    </div>
    <!-- Modal for playoffs -->
    <div class="modal-playoff" id="modal-playoff"></div>
    <div class="modal" id="playoff-modal">
      <h2 id="modal-title-playoff">Playoff Bracket</h2>
      <div id="modal-content-playoff">
        <div class="fixture-card-playoff" id="Qualifier">
          <div>Qualifier</div>

          <span class="team1">1st</span>&nbsp;&nbsp;
          <span class="score1">NaN</span>
          &nbsp;&nbsp; VS &nbsp;&nbsp;
          <span class="score2">NaN</span> &nbsp;&nbsp;
          <span class="team2">2nd</span>
        </div>

        <div class="fixture-card-playoff" id="Eliminator1">
          <div>Eliminator 1</div>
          <span class="team1">3rd</span>&nbsp;&nbsp;
          <span class="score1">NaN</span>
          &nbsp;&nbsp; VS &nbsp;&nbsp;
          <span class="score2">NaN</span> &nbsp;&nbsp;
          <span class="team2">4th</span>
        </div>

        <div class="fixture-card-playoff" id="Eliminator2">
          <div>Eliminator 2</div>
          <span class="team1">L of Q</span>&nbsp;&nbsp;
          <span class="score1">NaN</span>
          &nbsp;&nbsp; VS &nbsp;&nbsp;
          <span class="score2">NaN</span> &nbsp;&nbsp;
          <span class="team2">W of E1</span>
        </div>

        <div class="fixture-card-playoff" id="Final">
          <div>Final</div>
          <span class="team1">W of Q</span>&nbsp;&nbsp;
          <span class="score1">NaN</span>
          &nbsp;&nbsp; VS &nbsp;&nbsp;
          <span class="score2">NaN</span> &nbsp;&nbsp;
          <span class="team2">W of E2</span>
        </div>

        <div class="fixture-card-final-winner" id="FinalWinner">
          <div class="winner-text">
            <span class="winner-label">Champion</span>
            <span class="winner-name">W</span>
          </div>
        </div>
      </div>

      <span class="close-modal" id="close-modal-playoff">Close</span>
    </div>

    <script>
      // Fetch and insert navbar
      fetch("base.html")
        .then((response) => response.text())
        .then((data) => {
          document.getElementById("navbar-placeholder").innerHTML = data;

          // Ensure JavaScript for active link is executed after navbar is loaded
          const currentPage = window.location.pathname.split("/").pop(); // Get the current page name
          const navbarLinks = document.querySelectorAll(".navbar-item a"); // Get all navbar links

          navbarLinks.forEach((link) => {
            const linkPage = link.getAttribute("href").split("/").pop(); // Get the page name from the href

            if (currentPage === linkPage) {
              link.classList.add("active"); // Add the 'active' class to the current link
            }
          });
        });

      const fixtureData = [
        //Round 1
      ];
      const seasonData = {
        season1: [],
        season2: [
          //Round 1
          {
            teamA: "Sujan",
            scoreA: 1,
            date: "2025-2-17",
            time: "12:00 PM",
            scoreB: 2,
            teamB: "Dip",
          },
          {
            teamA: "Pujan",
            scoreA: 0,
            date: "2025-2-17",
            time: "02:30 PM",
            scoreB: 5,
            teamB: "Sudip",
          },
          {
            teamA: "Bijay",
            scoreA: 0,
            date: "2025-2-17",
            time: "03:00 PM",
            scoreB: 1,
            teamB: "Samrat",
          },
          //Round 2
          {
            teamA: "Dip",
            scoreA: NaN,
            date: "2025-2-18",
            time: "02:00 PM",
            scoreB: NaN,
            teamB: "Pujan",
          },
          {
            teamA: "Sujan",
            scoreA: NaN,
            date: "2025-2-18",
            time: "02:30 PM",
            scoreB: NaN,
            teamB: "Pujan",
          },
          {
            teamA: "Sudip",
            scoreA: NaN,
            date: "2025-2-18",
            time: "03:00 PM",
            scoreB: NaN,
            teamB: "Bijay",
          },
          {
            teamA: "Dip",
            scoreA: NaN,
            date: "2025-2-18",
            time: "03:30 PM",
            scoreB: NaN,
            teamB: "Sudip",
          },
          {
            teamA: "Samrat",
            scoreA: NaN,
            date: "2025-2-18",
            time: "08:30 PM",
            scoreB: NaN,
            teamB: "Ronish",
          },
          {
            teamA: "Ronish",
            scoreA: NaN,
            date: "2025-2-18",
            time: "09:00 PM",
            scoreB: NaN,
            teamB: "Sujan",
          },

          //Round 3
          {
            teamA: "Sujan",
            scoreA: NaN,
            date: "2025-2-19",
            time: "02:00 PM",
            scoreB: NaN,
            teamB: "Bijay",
          },
          {
            teamA: "Samrat",
            scoreA: NaN,
            date: "2025-2-19",
            time: "02:30 PM",
            scoreB: NaN,
            teamB: "Sujan",
          },
          {
            teamA: "Pujan",
            scoreA: NaN,
            date: "2025-2-19",
            time: "03:00 PM",
            scoreB: NaN,
            teamB: "Bijay",
          },
          {
            teamA: "Sudip",
            scoreA: NaN,
            date: "2025-2-19",
            time: "03:30 PM",
            scoreB: NaN,
            teamB: "Samrat",
          },
          {
            teamA: "Ronish",
            scoreA: NaN,
            date: "2025-2-19",
            time: "08:30 PM",
            scoreB: NaN,
            teamB: "Dip",
          },

          {
            teamA: "Bijay",
            scoreA: NaN,
            date: "2025-2-19",
            time: "09:00 PM",
            scoreB: NaN,
            teamB: "Ronish",
          },
          //Round 4

          {
            teamA: "Sudip",
            scoreA: NaN,
            date: "2025-2-20",
            time: "02:00 PM",
            scoreB: NaN,
            teamB: "Sujan",
          },
          {
            teamA: "Samrat",
            scoreA: NaN,
            date: "2025-2-20",
            time: "02:30 PM",
            scoreB: NaN,
            teamB: "Dip",
          },

          {
            teamA: "Pujan",
            scoreA: NaN,
            date: "2025-2-20",
            time: "03:00 PM",
            scoreB: NaN,
            teamB: "Samrat",
          },
          {
            teamA: "Dip",
            scoreA: NaN,
            date: "2025-2-20",
            time: "03:30 PM",
            scoreB: NaN,
            teamB: "Bijay",
          },
          {
            teamA: "Pujan",
            scoreA: NaN,
            date: "2025-2-20",
            time: "08:30 PM",
            scoreB: NaN,
            teamB: "Ronish",
          },
          {
            teamA: "Ronish",
            scoreA: NaN,
            date: "2025-2-20",
            time: "09:00 PM",
            scoreB: NaN,
            teamB: "Sudip",
          },
          //Round 5
          {
            teamA: "Dip",
            scoreA: NaN,
            date: "2025-2-21",
            time: "02:00 PM",
            scoreB: NaN,
            teamB: "Sujan",
          },
          {
            teamA: "Sudip",
            scoreA: NaN,
            date: "2025-2-21",
            time: "02:30 PM",
            scoreB: NaN,
            teamB: "Pujan",
          },
          {
            teamA: "Samrat",
            scoreA: NaN,
            date: "2025-2-21",
            time: "03:00 PM",
            scoreB: NaN,
            teamB: "Bijay",
          },

          {
            teamA: "Pujan",
            scoreA: NaN,
            date: "2025-2-21",
            time: "03:30 PM",
            scoreB: NaN,
            teamB: "Dip",
          },
          {
            teamA: "Bijay",
            scoreA: NaN,
            date: "2025-2-21",
            time: "08:30 PM",
            scoreB: NaN,
            teamB: "Sudip",
          },
          {
            teamA: "Sujan",
            scoreA: NaN,
            date: "2025-2-21",
            time: "09:00 PM",
            scoreB: NaN,
            teamB: "Ronish",
          },
          //Round 6

          {
            teamA: "Sudip",
            scoreA: NaN,
            date: "2025-2-22",
            time: "02:00 PM",
            scoreB: NaN,
            teamB: "Dip",
          },
          {
            teamA: "Pujan",
            scoreA: NaN,
            date: "2025-2-22",
            time: "02:30 PM",
            scoreB: NaN,
            teamB: "Sujan",
          },

          {
            teamA: "Sujan",
            scoreA: NaN,
            date: "2025-2-22",
            time: "03:00 PM",
            scoreB: NaN,
            teamB: "Samrat",
          },
          {
            teamA: "Bijay",
            scoreA: NaN,
            date: "2025-2-22",
            time: "03:30 PM",
            scoreB: NaN,
            teamB: "Pujan",
          },
          {
            teamA: "Ronish",
            scoreA: NaN,
            date: "2025-2-22",
            time: "08:30 PM",
            scoreB: NaN,
            teamB: "Samrat",
          },
          {
            teamA: "Ronish",
            scoreA: NaN,
            date: "2025-2-22",
            time: "09:00 PM",
            scoreB: NaN,
            teamB: "Bijay",
          },
          //Round 7
          {
            teamA: "Samrat",
            scoreA: NaN,
            date: "2025-2-23",
            time: "02:00 PM",
            scoreB: NaN,
            teamB: "Sudip",
          },

          {
            teamA: "Bijay",
            scoreA: NaN,
            date: "2025-2-23",
            time: "02:30 PM",
            scoreB: NaN,
            teamB: "Sujan",
          },

          {
            teamA: "Sujan",
            scoreA: NaN,
            date: "2025-2-23",
            time: "03:00 PM",
            scoreB: NaN,
            teamB: "Sudip",
          },
          {
            teamA: "Dip",
            scoreA: NaN,
            date: "2025-2-23",
            time: "03:30 PM",
            scoreB: NaN,
            teamB: "Samrat",
          },
          {
            teamA: "Ronish",
            scoreA: NaN,
            date: "2025-2-23",
            time: "08:30 PM",
            scoreB: NaN,
            teamB: "Pujan",
          },
          {
            teamA: "Dip",
            scoreA: NaN,
            date: "2025-2-23",
            time: "09:00 PM",
            scoreB: NaN,
            teamB: "Ronish",
          },
          //Round 8

          {
            teamA: "Samrat",
            scoreA: NaN,
            date: "2025-2-24",
            time: "02:00 PM",
            scoreB: NaN,
            teamB: "Pujan",
          },
          {
            teamA: "Bijay",
            scoreA: NaN,
            date: "2025-2-24",
            time: "02:30 PM",
            scoreB: NaN,
            teamB: "Dip",
          },
          {
            teamA: "Sudip",
            scoreA: NaN,
            date: "2025-2-24",
            time: "09:00 PM",
            scoreB: NaN,
            teamB: "Ronish",
          },
        ],
      };

      function renderFixtures(seasonKey) {
        const data = seasonData[seasonKey] || [];
        const container = document.getElementById("fixtures-container");
        container.innerHTML = ""; // Clear previous fixtures

        if (data.length === 0) {
          // If no data for the selected season, show the "No data available" message
          container.innerHTML = `<p class="no-data-message">No data available for this season.</p>`;
          return;
        }

        const fixturesByDate = data.reduce((acc, fixture) => {
          if (!acc[fixture.date]) {
            acc[fixture.date] = [];
          }
          acc[fixture.date].push(fixture);
          return acc;
        }, {});

        let roundNumber = 1;
        Object.keys(fixturesByDate).forEach((date) => {
          const card = document.createElement("div");
          card.className = "fixture-card";
          card.innerHTML = `
    <div class="fixture-header">
      <span>Round ${roundNumber}</span>
      <span>${date}</span>
    </div>
    <div class="fixture-details">
      <table class="fixture-table">
        <tbody>
          ${fixturesByDate[date]
            .map(
              (fixture) => `
              <tr>
                <td class="team" data-team="${fixture.teamA}">${
                fixture.teamA
              }</td>
                <td class="score">${
                  isNaN(fixture.scoreA) ? "-" : fixture.scoreA
                }</td>
                <td class="vs">vs</td>
                <td class="score">${
                  isNaN(fixture.scoreB) ? "-" : fixture.scoreB
                }</td>
                <td class="team" data-team="${fixture.teamB}">${
                fixture.teamB
              }</td>
                <td class="time">${fixture.time}</td>
              </tr>`
            )
            .join("")}
        </tbody>
      </table>
    </div>
  `;
          container.appendChild(card);
          roundNumber++;
        });

        // Reattach event listeners for team name clicks after rendering
        document.querySelectorAll(".team").forEach((teamElement) => {
          teamElement.addEventListener("click", (event) => {
            const teamName = event.target.getAttribute("data-team");
            showTeamHistory(teamName);
          });
        });
      }

      // Wait for the DOM to fully load before executing the script
      document.addEventListener("DOMContentLoaded", function () {
        // Set the dropdown value to 'Season 2' by default
        const seasonDropdown = document.getElementById("season-dropdown");
        seasonDropdown.value = "season2";

        // Now render the fixtures for 'Season 2'
        renderFixtures(seasonDropdown.value);

        // Event listener for dropdown change
        seasonDropdown.addEventListener("change", function () {
          const seasonKey = this.value; // Get the selected season value
          renderFixtures(seasonKey); // Rerender fixtures for the selected season
        });

        // Event delegation: Wait for fixtures to be rendered, then bind event listener to team elements
        document
          .getElementById("fixtures-container")
          .addEventListener("click", function (event) {
            if (event.target && event.target.classList.contains("team")) {
              const teamName = event.target.getAttribute("data-team");
              showTeamHistory(teamName, seasonDropdown.value); // Pass the seasonKey for the team history
            }
          });
      });

      function showTeamHistory(team, seasonKey) {
        const modal = document.getElementById("team-history-modal");
        const overlay = document.getElementById("modal-overlay");
        const modalTitle = document.getElementById("modal-title");
        const modalContent = document.getElementById("modal-content");

        // Get the current season data using seasonKey
        const data = seasonData[seasonKey] || [];
        console.log(data);
        console.log("SeasonKey", seasonKey); // Check if seasonKey is correctly passed

        // Filter fixtures for the selected team
        const teamFixtures = data.filter(
          (fixture) => fixture.teamA === team || fixture.teamB === team
        );

        // Log the filtered fixtures to ensure they exist
        console.log("Team Fixtures:", teamFixtures);

        // If no fixtures are found for the team, show a message
        if (teamFixtures.length === 0) {
          modalContent.innerHTML = `<p>No fixtures found for ${team}.</p>`;
        } else {
          // Set modal content
          modalTitle.textContent = `${team}'s Record`;
          modalContent.innerHTML = teamFixtures
            .map((fixture) => {
              const isVictory =
                (fixture.teamA === team && fixture.scoreA > fixture.scoreB) ||
                (fixture.teamB === team && fixture.scoreB > fixture.scoreA);
              const isDraw = fixture.scoreA === fixture.scoreB; // Check for draw
              const resultClass = isVictory ? "win" : isDraw ? "draw" : "loss";
              const resultText = isVictory ? "Win" : isDraw ? "Draw" : "Loss";

              // Check for NaN scores
              const isNaNScore = isNaN(fixture.scoreA) || isNaN(fixture.scoreB);
              const resultClassWithNaN = isNaNScore ? "NP" : resultClass;
              const resultTextWithNaN = isNaNScore ? "No Result" : resultText;

              return `
      <div class="history-card ${resultClassWithNaN}">
        <span>${fixture.date}&nbsp;&nbsp; ${fixture.time}</span>
        <div>
          ${fixture.teamA}&nbsp; ${
                isNaNScore ? "N/A" : fixture.scoreA
              }&nbsp; vs &nbsp;${isNaNScore ? "N/A" : fixture.scoreB} &nbsp;${
                fixture.teamB
              } 
          <strong> - ${resultTextWithNaN}</strong>
        </div>
      </div>
    `;
            })
            .join("");
        }

        // Open modal
        modal.classList.add("open");
        overlay.classList.add("open");
      }

      // Close modal
      document.getElementById("close-modal").addEventListener("click", () => {
        document.getElementById("team-history-modal").classList.remove("open");
        document.getElementById("modal-overlay").classList.remove("open");
      });

      // Function to render Playoff modal content
      function showPlayoffModal() {
        const modal = document.getElementById("playoff-modal");
        const overlay = document.getElementById("modal-overlay");
        const modalTitle = document.getElementById("modal-title-playoff");
        const modalContent = document.getElementById("modal-content-playoff");

        // Set title
        modalTitle.textContent = "Playoff Schedule";

        // Generate content for the playoff modal
        // modalContent.innerHTML = playoffData
        //   .map(
        //     (playoff, index) => `
        //     <div class="playoff-card">
        //       <span>Match ${index + 1}: ${playoff.teamA} vs ${playoff.teamB}</span>
        //       <div>
        //         <span>Date: ${playoff.date}</span>
        //         <span>Time: ${playoff.time}</span>
        //         <span>Score: ${isNaN(playoff.scoreA) ? "-" : playoff.scoreA} - ${
        //       isNaN(playoff.scoreB) ? "-" : playoff.scoreB
        //     }</span>
        //       </div>
        //     </div>
        //   `
        //   )
        //   .join("");

        // Open modal
        modal.classList.add("open");
        overlay.classList.add("open");
      }

      // Data for multiple seasons
      const playoffSeasons = {
        season1: {
          Qualifier: {
            team1: "Samrat (7)",
            team2: "(6)  Dip ",
            teamAScore: "3",
            teamBScore: "3",
          },
          Eliminator1: {
            team1: "Sujan",
            team2: "Mausam",
            teamAScore: "2",
            teamBScore: "1",
          },
          Eliminator2: {
            team1: "NaN",
            team2: "NaN",
            teamAScore: "NaN",
            teamBScore: "NaN",
          },
          Final: {
            team1: "Sujan",
            team2: "Samrat",
            teamAScore: "4",
            teamBScore: "2",
          },
          Champion: { name: "Sujan" },
        },
        season2: {
          Qualifier: {
            team1: "1st",
            team2: "2nd",
            teamAScore: "NaN",
            teamBScore: "NaN",
          },
          Eliminator1: {
            team1: "3rd",
            team2: "4th",
            teamAScore: "NaN",
            teamBScore: "NaN",
          },
          Eliminator2: {
            team1: "L of Q",
            team2: "W of E1",
            teamAScore: "NaN",
            teamBScore: "NaN",
          },
          Final: {
            team1: "W of Q",
            team2: "W of E2",
            teamAScore: "NaN",
            teamBScore: "NaN",
          },
          Champion: { name: "Winner of Final" },
        },
      };

      // Function to update team names and scores dynamically
      function updatePlayoffBracket(season) {
        const data = playoffSeasons[season];

        Object.keys(data).forEach((key) => {
          if (document.getElementById(key)) {
            const match = document.getElementById(key);
            match.querySelector(".team1").innerText = data[key].team1;
            match.querySelector(".team2").innerText = data[key].team2;
            match.querySelector(".score1").innerText = data[key].teamAScore;
            match.querySelector(".score2").innerText = data[key].teamBScore;
          }
        });

        // Update the champion name
        document.querySelector("#FinalWinner .winner-name").innerText =
          data.Champion.name;
      }

      // Listen for season selection changes
      document
        .getElementById("season-dropdown")
        .addEventListener("change", function () {
          updatePlayoffBracket(this.value);
        });

      // Initialize with default season (Season 1)
      updatePlayoffBracket("season2");

      // Close Playoff Modal
      document
        .getElementById("close-modal-playoff")
        .addEventListener("click", () => {
          document.getElementById("playoff-modal").classList.remove("open");
          document.getElementById("modal-overlay").classList.remove("open");
        });

      // Open Playoff Modal
      document.getElementById("playoff").addEventListener("click", () => {
        document.getElementById("playoff-modal").classList.add("open");
        document.getElementById("modal-overlay").classList.add("open");
      });

      // Add event listener to the Playoff heading
      document
        .getElementById("playoff")
        .addEventListener("click", showPlayoffModal);

      // Render fixtures
      renderFixtures("season1");
    </script>
  </body>
</html>
